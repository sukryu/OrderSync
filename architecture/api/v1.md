# ğŸ“¡ OrderSync API ì„¤ê³„ ë¬¸ì„œ (MVP)

> **Last Updated**: 2025-09-27  
> **Version**: 1.0.0 (MVP)  
> **Target**: 3ê°œì›” ë‚´ ì¶œì‹œ

-----

## ğŸ¯ **MVP ëª©í‘œ & ì œì•½ì‚¬í•­**

### **í•µì‹¬ ê°€ì¹˜ ê²€ì¦**

```
âœ… QR ìŠ¤ìº” â†’ ì£¼ë¬¸ â†’ ê²°ì œ â†’ ì‹¤ì‹œê°„ ì•Œë¦¼ (E2E í”Œë¡œìš°)
âœ… ì‚¬ì¥ë‹˜ì´ ì£¼ë¬¸ì„ ìŠ¹ì¸/ê±°ì ˆ/ì™„ë£Œ ì²˜ë¦¬
âœ… í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ì—°ë™
âœ… ê¸°ë³¸ì ì¸ ë³´ì•ˆ (JWT + HTTPS)
```

### **MVP ì„±ëŠ¥ ëª©í‘œ (í˜„ì‹¤ì )**

```
- ë™ì‹œ ì‚¬ìš©ì: 100ëª… (ì¶©ë¶„)
- API ì‘ë‹µ ì‹œê°„: P99 < 1s (ë§Œì¡±ìŠ¤ëŸ¬ì›€)
- ê°€ë™ë¥ : 99% (ì´ˆê¸° ë‹¨ê³„ ì ì ˆ)
- ì¼ì¼ ì£¼ë¬¸: 1,000ê±´ ì²˜ë¦¬ ê°€ëŠ¥
```

### **ì˜ë„ì ìœ¼ë¡œ ì œì™¸í•œ ê²ƒë“¤**

```
âŒ Circuit Breaker (í† ìŠ¤í˜ì´ ì•ˆì •ì ì´ë©´ ë¶ˆí•„ìš”)
âŒ GraphQL (RESTë¡œ ì¶©ë¶„)
âŒ Redis Cluster (ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì‹œì‘)
âŒ ë³µì¡í•œ Rate Limiting (IP ê¸°ë°˜ ê°„ë‹¨íˆ)
âŒ ë¶„ì‚° ì¶”ì  (ë¡œê·¸ë§Œìœ¼ë¡œ ì¶©ë¶„)
```

-----

## ğŸ—ï¸ **MVP ì•„í‚¤í…ì²˜ (ë‹¨ìˆœí™”)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Nginx (Rate Limit)          â”‚
â”‚         - IP ê¸°ë°˜ ì œí•œ              â”‚
â”‚         - HTTPS ì¢…ë£Œ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Go API Server              â”‚
â”‚    - JWT ì¸ì¦/ì¸ê°€                  â”‚
â”‚    - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§                  â”‚
â”‚    - í† ìŠ¤í˜ì´ ì—°ë™                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL + Redis (ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤) â”‚
â”‚    - íŠ¸ëœì­ì…˜ ë°ì´í„° (PG)           â”‚
â”‚    - ì„¸ì…˜/ìºì‹œ (Redis)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

-----

## ğŸ“‹ **API ì—”ë“œí¬ì¸íŠ¸ (MVP ì „ì²´)**

### **1. ì¸ì¦ API (4ê°œ)**

```
POST   /api/v1/auth/register        # íšŒì›ê°€ì…
POST   /api/v1/auth/login           # ë¡œê·¸ì¸
POST   /api/v1/auth/refresh         # í† í° ê°±ì‹ 
GET    /api/v1/auth/me              # ë‚´ ì •ë³´ ì¡°íšŒ
```

### **2. ê³ ê° ì£¼ë¬¸ API (3ê°œ)**

```
GET    /api/v1/restaurants/{id}/menu    # ë©”ë‰´ ì¡°íšŒ (ì¸ì¦ ë¶ˆí•„ìš”)
POST   /api/v1/orders                   # ì£¼ë¬¸ ìƒì„±
GET    /api/v1/orders/{id}              # ì£¼ë¬¸ ì¡°íšŒ
```

### **3. ì‚¬ì¥ë‹˜ ê´€ë¦¬ API (5ê°œ)**

```
GET    /api/v1/restaurants/me/orders               # ì£¼ë¬¸ ëª©ë¡
POST   /api/v1/restaurants/me/orders/{id}/accept   # ì£¼ë¬¸ ìŠ¹ì¸
POST   /api/v1/restaurants/me/orders/{id}/reject   # ì£¼ë¬¸ ê±°ì ˆ
POST   /api/v1/restaurants/me/orders/{id}/ready    # ì¤€ë¹„ ì™„ë£Œ
POST   /api/v1/restaurants/me/orders/{id}/complete # ì£¼ë¬¸ ì™„ë£Œ
```

### **4. ê²°ì œ API (2ê°œ)**

```
POST   /api/v1/payments/initiate    # ê²°ì œ ì‹œì‘ (í† ìŠ¤í˜ì´ ì—°ë™)
POST   /api/v1/payments/confirm     # ê²°ì œ í™•ì¸ (í† ìŠ¤í˜ì´ ì½œë°±)
```

### **5. ì‹¤ì‹œê°„ ì•Œë¦¼ (1ê°œ)**

```
WebSocket /ws/orders/{order_id}     # ì£¼ë¬¸ ìƒíƒœ ì‹¤ì‹œê°„ êµ¬ë…
```

**ì´ 15ê°œ ì—”ë“œí¬ì¸íŠ¸ (MVPì— ì¶©ë¶„)**

-----

## ğŸ” **ë³´ì•ˆ ì„¤ê³„ (ë‹¨ìˆœí™”)**

### **ì¸ì¦ íë¦„ (JWT ê¸°ë°˜)**

```go
// 1. ë¡œê·¸ì¸ â†’ JWT ë°œê¸‰
POST /api/v1/auth/login
Request:
{
  "email": "user@example.com",
  "password": "securePass123!"
}

Response:
{
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "expires_in": 3600,
  "user": {
    "id": "uuid",
    "name": "í™ê¸¸ë™",
    "role": "CUSTOMER" // or "OWNER"
  }
}

// 2. ì´í›„ ìš”ì²­ ì‹œ í—¤ë”ì— í† í° í¬í•¨
Authorization: Bearer eyJhbGc...
```

### **ê°„ë‹¨í•œ ë¯¸ë“¤ì›¨ì–´ ì²´ì¸**

```go
// ëª¨ë“  API ìš”ì²­ íë¦„
Request â†’ RateLimitMiddleware â†’ AuthMiddleware â†’ Handler

// Rate Limiting (Nginx ë ˆë²¨)
- IPë‹¹ ë¶„ë‹¹ 60íšŒ ì œí•œ (ì¶©ë¶„íˆ ê´€ëŒ€)

// Auth Middleware (Go ë ˆë²¨)
func AuthMiddleware(c *gin.Context) {
    token := c.GetHeader("Authorization")
    claims, err := jwt.Validate(token)
    if err != nil {
        c.JSON(401, gin.H{"error": "Unauthorized"})
        return
    }
    c.Set("user_id", claims.UserID)
    c.Set("user_role", claims.Role)
    c.Next()
}
```

### **ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ (bcrypt)**

```go
// íšŒì›ê°€ì… ì‹œ
hashedPassword, _ := bcrypt.GenerateFromPassword(
    []byte(plainPassword), 
    bcrypt.DefaultCost, // Cost 10 (ì ë‹¹í•œ ë³´ì•ˆ ìˆ˜ì¤€)
)

// ë¡œê·¸ì¸ ì‹œ
err := bcrypt.CompareHashAndPassword(
    []byte(storedHash), 
    []byte(plainPassword),
)
```

-----

## ğŸ“¡ **í•µì‹¬ API ìƒì„¸ ì„¤ê³„**

### **1. ë©”ë‰´ ì¡°íšŒ (ì¸ì¦ ë¶ˆí•„ìš”)**

```http
GET /api/v1/restaurants/{restaurant_id}/menu
```

**Response** (200 OK):

```json
{
  "restaurant": {
    "id": "uuid",
    "name": "ë§›ìˆëŠ” ì¹˜í‚¨ì§‘",
    "table_ordering_enabled": true
  },
  "categories": [
    {
      "id": "uuid",
      "name": "ì¸ê¸° ë©”ë‰´",
      "items": [
        {
          "id": "uuid",
          "name": "í›„ë¼ì´ë“œ ì¹˜í‚¨",
          "price": 18000,
          "description": "ë°”ì‚­í•œ í›„ë¼ì´ë“œ",
          "image_url": "https://cdn.ordersync.com/menu/123.jpg",
          "is_available": true,
          "options": [
            {
              "id": "uuid",
              "name": "ìˆœí•œë§›/ë§¤ìš´ë§›",
              "choices": ["ìˆœí•œë§›", "ë§¤ìš´ë§›"],
              "required": true
            }
          ]
        }
      ]
    }
  ]
}
```

**ìºì‹± ì „ëµ**:

```go
// Redis ìºì‹œ (TTL: 5ë¶„)
cacheKey := fmt.Sprintf("menu:%s", restaurantID)
if cached := redis.Get(cacheKey); cached != nil {
    return cached
}

// DB ì¡°íšŒ í›„ ìºì‹±
menu := db.GetMenu(restaurantID)
redis.SetEx(cacheKey, menu, 5*time.Minute)
return menu
```

-----

### **2. ì£¼ë¬¸ ìƒì„±**

```http
POST /api/v1/orders
Authorization: Bearer {token}
```

**Request**:

```json
{
  "restaurant_id": "uuid",
  "table_number": "3",
  "items": [
    {
      "menu_id": "uuid",
      "quantity": 2,
      "options": [
        {
          "option_id": "uuid",
          "choice": "ë§¤ìš´ë§›"
        }
      ]
    }
  ],
  "special_requests": "ì–‘íŒŒ ë¹¼ì£¼ì„¸ìš”"
}
```

**Response** (201 Created):

```json
{
  "order_id": "uuid",
  "order_number": "A001",
  "status": "PENDING",
  "total_amount": 36000,
  "payment_required": true,
  "payment_url": "https://pay.toss.im/...",
  "websocket_url": "wss://api.ordersync.com/ws/orders/uuid"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** (ë‹¨ìˆœí™”):

```go
func CreateOrder(req *CreateOrderRequest) (*Order, error) {
    // 1. ë©”ë‰´ ê°€ê²© ê²€ì¦ (í´ë¼ì´ì–¸íŠ¸ ë¯¿ì§€ ì•Šê¸°)
    calculatedTotal := 0
    for _, item := range req.Items {
        menu := db.GetMenu(item.MenuID)
        calculatedTotal += menu.Price * item.Quantity
    }
    
    // 2. ì£¼ë¬¸ ìƒì„±
    order := &Order{
        ID:           uuid.New(),
        RestaurantID: req.RestaurantID,
        CustomerID:   GetUserID(ctx),
        TotalAmount:  calculatedTotal,
        Status:       "PENDING",
    }
    db.Create(order)
    
    // 3. í† ìŠ¤í˜ì´ ê²°ì œ URL ìƒì„±
    paymentURL := toss.CreatePayment(order.ID, calculatedTotal)
    
    // 4. WebSocket ì•Œë¦¼ (ì‚¬ì¥ë‹˜ì—ê²Œ)
    ws.Notify(req.RestaurantID, "NEW_ORDER", order)
    
    return order, nil
}
```

-----

### **3. ì£¼ë¬¸ ìŠ¹ì¸ (ì‚¬ì¥ë‹˜ ì „ìš©)**

```http
POST /api/v1/restaurants/me/orders/{order_id}/accept
Authorization: Bearer {owner_token}
```

**Request**:

```json
{
  "estimated_time_minutes": 15,
  "message": "ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!"
}
```

**Response** (200 OK):

```json
{
  "order_id": "uuid",
  "status": "ACCEPTED",
  "estimated_ready_at": "2025-09-27T12:30:00Z"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:

```go
func AcceptOrder(orderID string, req *AcceptRequest) error {
    // 1. ê¶Œí•œ í™•ì¸ (ì‚¬ì¥ë‹˜ë§Œ ê°€ëŠ¥)
    order := db.GetOrder(orderID)
    if order.RestaurantID != GetOwnerRestaurantID(ctx) {
        return errors.New("Forbidden")
    }
    
    // 2. ìƒíƒœ ë³€ê²½ (PENDING â†’ ACCEPTED)
    if order.Status != "PENDING" {
        return errors.New("Order already processed")
    }
    order.Status = "ACCEPTED"
    order.EstimatedReadyAt = time.Now().Add(
        time.Duration(req.EstimatedTimeMinutes) * time.Minute,
    )
    db.Update(order)
    
    // 3. ê³ ê°ì—ê²Œ ì‹¤ì‹œê°„ ì•Œë¦¼
    ws.Notify(order.CustomerID, "ORDER_ACCEPTED", order)
    
    return nil
}
```

-----

### **4. ê²°ì œ ì—°ë™ (í† ìŠ¤í˜ì´ë¨¼ì¸ )**

#### **Step 1: ê²°ì œ ì‹œì‘**

```http
POST /api/v1/payments/initiate
```

**Request**:

```json
{
  "order_id": "uuid",
  "amount": 36000,
  "payment_method": "CARD"
}
```

**Response** (200 OK):

```json
{
  "payment_key": "toss_payment_key_123",
  "payment_url": "https://pay.toss.im/abc123",
  "order_id": "uuid",
  "amount": 36000,
  "expires_at": "2025-09-27T12:45:00Z"
}
```

**í† ìŠ¤í˜ì´ ì—°ë™ ì½”ë“œ**:

```go
func InitiatePayment(req *InitiatePaymentRequest) (*PaymentResponse, error) {
    order := db.GetOrder(req.OrderID)
    
    // í† ìŠ¤í˜ì´ API í˜¸ì¶œ
    tossReq := &toss.CreatePaymentRequest{
        Amount:      req.Amount,
        OrderID:     req.OrderID,
        OrderName:   fmt.Sprintf("ì£¼ë¬¸ #%s", order.OrderNumber),
        SuccessURL:  "https://ordersync.com/payment/success",
        FailURL:     "https://ordersync.com/payment/fail",
    }
    
    tossResp, err := toss.CreatePayment(tossReq)
    if err != nil {
        return nil, err
    }
    
    // Payment ë ˆì½”ë“œ ìƒì„±
    payment := &Payment{
        ID:            uuid.New(),
        OrderID:       req.OrderID,
        Amount:        req.Amount,
        Status:        "PENDING",
        TossPaymentKey: tossResp.PaymentKey,
    }
    db.Create(payment)
    
    return &PaymentResponse{
        PaymentKey: tossResp.PaymentKey,
        PaymentURL: tossResp.PaymentURL,
    }, nil
}
```

#### **Step 2: ê²°ì œ í™•ì¸ (í† ìŠ¤í˜ì´ ì½œë°±)**

```http
POST /api/v1/payments/confirm
```

**Request** (í† ìŠ¤í˜ì´ì—ì„œ ì „ì†¡):

```json
{
  "paymentKey": "toss_payment_key_123",
  "orderId": "uuid",
  "amount": 36000
}
```

**Response** (200 OK):

```json
{
  "success": true,
  "order_id": "uuid",
  "payment_status": "COMPLETED"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:

```go
func ConfirmPayment(req *ConfirmPaymentRequest) error {
    // 1. í† ìŠ¤í˜ì´ ìŠ¹ì¸ API í˜¸ì¶œ
    tossResp, err := toss.ConfirmPayment(req.PaymentKey, req.Amount)
    if err != nil {
        return err
    }
    
    // 2. Payment & Order ìƒíƒœ ì—…ë°ì´íŠ¸
    payment := db.GetPaymentByTossKey(req.PaymentKey)
    payment.Status = "COMPLETED"
    payment.ApprovedAt = time.Now()
    db.Update(payment)
    
    order := db.GetOrder(payment.OrderID)
    order.PaymentStatus = "PAID"
    db.Update(order)
    
    // 3. ì‚¬ì¥ë‹˜ì—ê²Œ ì•Œë¦¼
    ws.Notify(order.RestaurantID, "PAYMENT_COMPLETED", order)
    
    return nil
}
```

-----

### **5. ì‹¤ì‹œê°„ ì•Œë¦¼ (WebSocket)**

```
WebSocket: wss://api.ordersync.com/ws/orders/{order_id}
```

**ì—°ê²° íë¦„**:

```go
// í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
ws, _ := websocket.Dial("wss://api.ordersync.com/ws/orders/123")

// ë©”ì‹œì§€ ìˆ˜ì‹ 
for {
    var msg OrderStatusMessage
    ws.ReadJSON(&msg)
    
    // UI ì—…ë°ì´íŠ¸
    updateOrderStatus(msg.Status)
}
```

**ì„œë²„ ë©”ì‹œì§€ í˜•ì‹**:

```json
{
  "type": "STATUS_CHANGED",
  "order_id": "uuid",
  "status": "ACCEPTED",
  "estimated_ready_at": "2025-09-27T12:30:00Z",
  "message": "ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

**WebSocket êµ¬í˜„** (ë‹¨ìˆœí™”):

```go
func HandleOrderWebSocket(c *gin.Context) {
    orderID := c.Param("order_id")
    
    // WebSocket ì—…ê·¸ë ˆì´ë“œ
    conn, _ := upgrader.Upgrade(c.Writer, c.Request, nil)
    defer conn.Close()
    
    // Redis Pub/Sub êµ¬ë…
    sub := redis.Subscribe("order:" + orderID)
    defer sub.Close()
    
    // ë©”ì‹œì§€ ì „ë‹¬
    for msg := range sub.Channel() {
        conn.WriteJSON(msg.Payload)
    }
}

// ë‹¤ë¥¸ í•¸ë“¤ëŸ¬ì—ì„œ ì•Œë¦¼ ë°œì†¡
func NotifyOrderUpdate(orderID string, data interface{}) {
    redis.Publish("order:"+orderID, data)
}
```

-----

## ğŸ“Š **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (MVP)**

### **PostgreSQL í…Œì´ë¸” (í•µì‹¬ë§Œ)**

```sql
-- ì‚¬ìš©ì
CREATE TABLE users (
    id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL, -- 'CUSTOMER', 'OWNER'
    created_at TIMESTAMP DEFAULT NOW()
);

-- ë§¤ì¥
CREATE TABLE restaurants (
    id UUID PRIMARY KEY,
    owner_id UUID REFERENCES users(id),
    name VARCHAR(200) NOT NULL,
    table_ordering_enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ë©”ë‰´
CREATE TABLE menus (
    id UUID PRIMARY KEY,
    restaurant_id UUID REFERENCES restaurants(id),
    name VARCHAR(200) NOT NULL,
    price INTEGER NOT NULL,
    is_available BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ì£¼ë¬¸
CREATE TABLE orders (
    id UUID PRIMARY KEY,
    restaurant_id UUID REFERENCES restaurants(id),
    customer_id UUID REFERENCES users(id),
    order_number VARCHAR(10) NOT NULL,
    table_number VARCHAR(10),
    total_amount INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL, -- 'PENDING', 'ACCEPTED', 'READY', 'COMPLETED'
    payment_status VARCHAR(20) DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_restaurant_status (restaurant_id, status),
    INDEX idx_customer (customer_id)
);

-- ì£¼ë¬¸ í•­ëª©
CREATE TABLE order_items (
    id UUID PRIMARY KEY,
    order_id UUID REFERENCES orders(id),
    menu_id UUID REFERENCES menus(id),
    quantity INTEGER NOT NULL,
    unit_price INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ê²°ì œ
CREATE TABLE payments (
    id UUID PRIMARY KEY,
    order_id UUID REFERENCES orders(id),
    amount INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL, -- 'PENDING', 'COMPLETED', 'FAILED'
    toss_payment_key VARCHAR(255),
    approved_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### **Redis ì‚¬ìš© (ë‹¨ìˆœí™”)**

```go
// 1. JWT í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (ë¡œê·¸ì•„ì›ƒ)
redis.Set("blacklist:token_123", "1", 24*time.Hour)

// 2. ë©”ë‰´ ìºì‹œ
redis.Set("menu:restaurant_id", menuJSON, 5*time.Minute)

// 3. ì‹¤ì‹œê°„ ì•Œë¦¼ (Pub/Sub)
redis.Publish("order:order_id", messageJSON)
```

-----

## ğŸ” **ì—ëŸ¬ ì²˜ë¦¬ (ì¼ê´€ì„±)**

### **í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹**

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "ìš”ì²­ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤",
    "details": {
      "field": "email",
      "reason": "ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤"
    }
  }
}
```

### **ì£¼ìš” ì—ëŸ¬ ì½”ë“œ**

|HTTP Status|Error Code         |ì„¤ëª…                 |
|-----------|-------------------|-------------------|
|400        |VALIDATION_ERROR   |ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨           |
|401        |UNAUTHORIZED       |ì¸ì¦ ì‹¤íŒ¨              |
|403        |FORBIDDEN          |ê¶Œí•œ ì—†ìŒ              |
|404        |NOT_FOUND          |ë¦¬ì†ŒìŠ¤ ì—†ìŒ             |
|409        |CONFLICT           |ìƒíƒœ ì¶©ëŒ (ì´ë¯¸ ì²˜ë¦¬ëœ ì£¼ë¬¸ ë“±)|
|429        |RATE_LIMIT_EXCEEDED|ìš”ì²­ í•œë„ ì´ˆê³¼           |
|500        |INTERNAL_ERROR     |ì„œë²„ ì˜¤ë¥˜              |

### **ì—ëŸ¬ í•¸ë“¤ë§ ì½”ë“œ**

```go
// Custom Error Type
type APIError struct {
    StatusCode int
    Code       string
    Message    string
    Details    interface{}
}

// Error Middleware
func ErrorHandler(c *gin.Context) {
    c.Next()
    
    if len(c.Errors) > 0 {
        err := c.Errors.Last()
        
        switch e := err.Err.(type) {
        case *APIError:
            c.JSON(e.StatusCode, gin.H{
                "error": gin.H{
                    "code":    e.Code,
                    "message": e.Message,
                    "details": e.Details,
                },
            })
        default:
            c.JSON(500, gin.H{
                "error": gin.H{
                    "code":    "INTERNAL_ERROR",
                    "message": "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
                },
            })
        }
    }
}
```

-----

## ğŸ“ˆ **ëª¨ë‹ˆí„°ë§ & ë¡œê¹… (ìµœì†Œí•œ)**

### **êµ¬ì¡°í™”ëœ ë¡œê¹…**

```go
// ëª¨ë“  API ìš”ì²­ ë¡œê·¸
log.WithFields(log.Fields{
    "method":    c.Request.Method,
    "path":      c.Request.URL.Path,
    "status":    c.Writer.Status(),
    "duration":  time.Since(start),
    "user_id":   GetUserID(c),
    "ip":        c.ClientIP(),
}).Info("API Request")
```

### **í•µì‹¬ ë©”íŠ¸ë¦­ (Prometheus)**

```go
// API ìš”ì²­ ìˆ˜
apiRequestsTotal.WithLabelValues(
    c.Request.Method,
    c.Request.URL.Path,
    strconv.Itoa(c.Writer.Status()),
).Inc()

// ì‘ë‹µ ì‹œê°„
apiRequestDuration.WithLabelValues(
    c.Request.URL.Path,
).Observe(time.Since(start).Seconds())
```

### **ì•ŒëŒ ì„¤ì • (ì¤‘ìš”í•œ ê²ƒë§Œ)**

```yaml
# ì•ŒëŒ ê·œì¹™ (Alertmanager)
- alert: HighErrorRate
  expr: sum(rate(api_requests_total{status=~"5.."}[5m])) > 10
  annotations:
    summary: "5ë¶„ê°„ 5xx ì—ëŸ¬ 10ê±´ ì´ˆê³¼"
    
- alert: SlowAPI
  expr: api_request_duration{path="/api/v1/orders"} > 2
  annotations:
    summary: "ì£¼ë¬¸ API ì‘ë‹µ 2ì´ˆ ì´ˆê³¼"
```

-----

## ğŸš€ **ë°°í¬ ì „ëµ (MVP)**

### **ë‹¨ìˆœ Docker Compose ë°°í¬**

```yaml
# docker-compose.yml
version: '3.8'

services:
  api:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgresql://...
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - TOSS_SECRET_KEY=${TOSS_SECRET_KEY}
    depends_on:
      - postgres
      - redis
  
  postgres:
    image: postgres:15
    volumes:
      - pgdata:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: ordersync
      POSTGRES_PASSWORD: ${DB_PASSWORD}
  
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redisdata:/data
  
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - api

volumes:
  pgdata:
  redisdata:
```

### **í™˜ê²½ ë³€ìˆ˜ (.env)**

```bash
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://user:pass@localhost:5432/ordersync

# Redis
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET=your-256-bit-secret-here
JWT_EXPIRES_IN=3600

# í† ìŠ¤í˜ì´ë¨¼ì¸ 
TOSS_SECRET_KEY=test_sk_...
TOSS_CLIENT_KEY=test_ck_...

# ì„œë²„
PORT=8080
ENV=production
```

-----

## ğŸ“ **ë‹¤ìŒ ë‹¨ê³„ (MVP êµ¬í˜„)**

### **Week 1-2: ê¸°ë³¸ ì¸í”„ë¼**

```bash
âœ… Go í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
âœ… PostgreSQL ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
âœ… JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
âœ… ê¸°ë³¸ CRUD êµ¬í˜„
```

### **Week 3-4: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**

```bash
âœ… ì£¼ë¬¸ ìƒì„±/ì¡°íšŒ API
âœ… ì‚¬ì¥ë‹˜ ì£¼ë¬¸ ê´€ë¦¬ API
âœ… WebSocket ì‹¤ì‹œê°„ ì•Œë¦¼
```

### **Week 5-6: ê²°ì œ & í…ŒìŠ¤íŠ¸**

```bash
âœ… í† ìŠ¤í˜ì´ë¨¼ì¸  ì—°ë™
âœ… E2E í…ŒìŠ¤íŠ¸
âœ… ë¶€í•˜ í…ŒìŠ¤íŠ¸ (100 ë™ì‹œ ì‚¬ìš©ì)
âœ… MVP ë°°í¬
```

-----

## ğŸ¯ **MVP ì„±ê³µ ê¸°ì¤€**

```
âœ… QR ìŠ¤ìº”ë¶€í„° ê²°ì œ ì™„ë£Œê¹Œì§€ 5ë¶„ ì´ë‚´
âœ… ì‚¬ì¥ë‹˜ì´ ì£¼ë¬¸ì„ 3ì´ˆ ì´ë‚´ í™•ì¸
âœ… ê²°ì œ ì„±ê³µë¥  95% ì´ìƒ
âœ… API ì‘ë‹µ ì‹œê°„ P99 < 1ì´ˆ
âœ… ì¼ì¼ 100ê±´ ì£¼ë¬¸ ì•ˆì •ì  ì²˜ë¦¬
```

**MVP ì™„ë£Œ í›„ â†’ Phase 2 ê³ ë„í™” ì‹œì‘**

-----

<div align="center">

**OrderSync API v1.0.0 (MVP)**

*Simple, Secure, Scalable*

**Last Updated: 2025-09-27**

</div>
